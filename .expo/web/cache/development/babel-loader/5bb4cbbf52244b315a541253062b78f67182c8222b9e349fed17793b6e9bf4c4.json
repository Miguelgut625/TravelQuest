{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport { supabase } from \"./supabase\";\nexport var checkJournalTables = function () {\n  var _ref = _asyncToGenerator(function* () {\n    try {\n      var _yield$Promise$allSet = yield Promise.allSettled([supabase.from('journal_entries').select('id').limit(1), supabase.from('journey_diary').select('id').limit(1)]),\n        _yield$Promise$allSet2 = _slicedToArray(_yield$Promise$allSet, 2),\n        journalEntriesResult = _yield$Promise$allSet2[0],\n        journeyDiaryResult = _yield$Promise$allSet2[1];\n      return {\n        journalEntriesExists: journalEntriesResult.status === 'fulfilled' && !journalEntriesResult.value.error,\n        journeyDiaryExists: journeyDiaryResult.status === 'fulfilled' && !journeyDiaryResult.value.error\n      };\n    } catch (error) {\n      console.error('Error verificando tablas del diario:', error);\n      return {\n        journalEntriesExists: false,\n        journeyDiaryExists: false\n      };\n    }\n  });\n  return function checkJournalTables() {\n    return _ref.apply(this, arguments);\n  };\n}();\nexport var getUserJournalEntries = function () {\n  var _ref2 = _asyncToGenerator(function* (userId) {\n    try {\n      var _yield$checkJournalTa = yield checkJournalTables(),\n        journalEntriesExists = _yield$checkJournalTa.journalEntriesExists,\n        journeyDiaryExists = _yield$checkJournalTa.journeyDiaryExists;\n      if (!journalEntriesExists && !journeyDiaryExists) {\n        console.warn('No se encontraron tablas para el diario (journal_entries o journey_diary)');\n        return {};\n      }\n      var entriesData = null;\n      var error = null;\n      if (journalEntriesExists) {\n        try {\n          var _yield$supabase$from$ = yield supabase.from('journal_entries').select(`\n            *,\n            cities:cityId (\n              name\n            )\n          `).eq('userId', userId).order('created_at', {\n              ascending: false\n            }),\n            data = _yield$supabase$from$.data,\n            entriesError = _yield$supabase$from$.error;\n          if (!entriesError) {\n            entriesData = data;\n          } else if (entriesError.message && (entriesError.message.includes('cityId') || entriesError.message.includes('relationship') || entriesError.code === 'PGRST200')) {\n            var _yield$supabase$from$2 = yield supabase.from('journal_entries').select('*').eq('userId', userId).order('created_at', {\n                ascending: false\n              }),\n              basicData = _yield$supabase$from$2.data,\n              basicError = _yield$supabase$from$2.error;\n            if (!basicError) {\n              entriesData = basicData;\n            } else {\n              error = basicError;\n            }\n          } else {\n            error = entriesError;\n          }\n        } catch (e) {\n          console.warn('Error al obtener datos de journal_entries:', e);\n        }\n      }\n      if (!entriesData && journeyDiaryExists) {\n        try {\n          var _yield$supabase$from$3 = yield supabase.from('journey_diary').select(`\n            *,\n            cities:cityId (\n              name\n            )\n          `).eq('userId', userId).order('created_at', {\n              ascending: false\n            }),\n            _data = _yield$supabase$from$3.data,\n            diaryError = _yield$supabase$from$3.error;\n          if (!diaryError) {\n            entriesData = _data;\n          } else if (diaryError.message && (diaryError.message.includes('cityId') || diaryError.message.includes('relationship') || diaryError.code === 'PGRST200')) {\n            var _yield$supabase$from$4 = yield supabase.from('journey_diary').select('*').eq('userId', userId).order('created_at', {\n                ascending: false\n              }),\n              _basicData = _yield$supabase$from$4.data,\n              _basicError = _yield$supabase$from$4.error;\n            if (!_basicError) {\n              entriesData = _basicData;\n            } else if (!error) {\n              error = _basicError;\n            }\n          } else if (!error) {\n            error = diaryError;\n          }\n        } catch (e) {\n          console.warn('Error al obtener datos de journey_diary:', e);\n        }\n      }\n      if (!entriesData && error) {\n        throw error;\n      }\n      if (!entriesData) {\n        return {};\n      }\n      return organizeCityEntries(entriesData, true);\n    } catch (error) {\n      console.error('Error obteniendo entradas del diario:', error);\n      throw error;\n    }\n  });\n  return function getUserJournalEntries(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nvar organizeCityEntries = function organizeCityEntries(data) {\n  var missingCityRelation = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n  var entriesByCity = {};\n  if (!data || data.length === 0) {\n    return entriesByCity;\n  }\n  data.forEach(function (entry) {\n    var _entry$cities;\n    var cityName = 'Ciudad Desconocida';\n    if (!missingCityRelation && (_entry$cities = entry.cities) != null && _entry$cities.name) {\n      cityName = entry.cities.name;\n    } else if (entry.cityName) {\n      cityName = entry.cityName;\n    } else if (entry.city_name) {\n      cityName = entry.city_name;\n    } else {\n      if (entry.tags && Array.isArray(entry.tags)) {\n        var cityTag = entry.tags.find(function (tag) {\n          return tag !== 'misión' && tag !== 'mission' && tag !== 'viaje' && tag !== 'travel';\n        });\n        if (cityTag) {\n          cityName = cityTag.charAt(0).toUpperCase() + cityTag.slice(1);\n        }\n      }\n    }\n    if (!entriesByCity[cityName]) {\n      entriesByCity[cityName] = [];\n    }\n    var processedEntry = {\n      id: entry.id || `generated-${Date.now()}-${Math.random().toString(36).substring(2, 9)}`,\n      userId: entry.userId || '',\n      cityId: entry.cityId || '',\n      missionId: entry.missionId || undefined,\n      title: entry.title || 'Entrada sin título',\n      content: entry.content || '',\n      photos: Array.isArray(entry.photos) ? entry.photos : entry.photos ? [entry.photos] : [],\n      location: entry.location || null,\n      created_at: entry.created_at || new Date().toISOString(),\n      tags: Array.isArray(entry.tags) ? entry.tags : [],\n      city_name: cityName\n    };\n    entriesByCity[cityName].push(processedEntry);\n  });\n  return entriesByCity;\n};\nexport var getMissionJournalEntries = function () {\n  var _ref3 = _asyncToGenerator(function* (userId, missionId) {\n    try {\n      var _yield$checkJournalTa2 = yield checkJournalTables(),\n        journalEntriesExists = _yield$checkJournalTa2.journalEntriesExists,\n        journeyDiaryExists = _yield$checkJournalTa2.journeyDiaryExists;\n      if (!journalEntriesExists && !journeyDiaryExists) {\n        console.warn('No se encontraron tablas para el diario (journal_entries o journey_diary)');\n        return [];\n      }\n      var entriesData = null;\n      var error = null;\n      if (journalEntriesExists) {\n        try {\n          var _yield$supabase$from$5 = yield supabase.from('journal_entries').select(`\n            *,\n            cities:cityId (\n              name\n            )\n          `).eq('userId', userId).eq('missionId', missionId).order('created_at', {\n              ascending: false\n            }),\n            data = _yield$supabase$from$5.data,\n            entriesError = _yield$supabase$from$5.error;\n          if (!entriesError) {\n            entriesData = data;\n          } else if (entriesError.message && (entriesError.message.includes('cityId') || entriesError.message.includes('relationship') || entriesError.code === 'PGRST200')) {\n            var _yield$supabase$from$6 = yield supabase.from('journal_entries').select('*').eq('userId', userId).eq('missionId', missionId).order('created_at', {\n                ascending: false\n              }),\n              basicData = _yield$supabase$from$6.data,\n              basicError = _yield$supabase$from$6.error;\n            if (!basicError) {\n              entriesData = basicData;\n            } else {\n              error = basicError;\n            }\n          } else {\n            error = entriesError;\n          }\n        } catch (e) {\n          console.warn('Error al obtener datos de journal_entries para misión:', e);\n        }\n      }\n      if (!entriesData && journeyDiaryExists) {\n        try {\n          var _yield$supabase$from$7 = yield supabase.from('journey_diary').select(`\n            *,\n            cities:cityId (\n              name\n            )\n          `).eq('userId', userId).eq('missionId', missionId).order('created_at', {\n              ascending: false\n            }),\n            _data2 = _yield$supabase$from$7.data,\n            diaryError = _yield$supabase$from$7.error;\n          if (!diaryError) {\n            entriesData = _data2;\n          } else if (diaryError.message && (diaryError.message.includes('cityId') || diaryError.message.includes('relationship') || diaryError.code === 'PGRST200')) {\n            var _yield$supabase$from$8 = yield supabase.from('journey_diary').select('*').eq('userId', userId).eq('missionId', missionId).order('created_at', {\n                ascending: false\n              }),\n              _basicData2 = _yield$supabase$from$8.data,\n              _basicError2 = _yield$supabase$from$8.error;\n            if (!_basicError2) {\n              entriesData = _basicData2;\n            } else if (!error) {\n              error = _basicError2;\n            }\n          } else if (!error) {\n            error = diaryError;\n          }\n        } catch (e) {\n          console.warn('Error al obtener datos de journey_diary para misión:', e);\n        }\n      }\n      if (!entriesData && error) {\n        throw error;\n      }\n      if (!entriesData || entriesData.length === 0) {\n        return [];\n      }\n      return entriesData.map(function (entry) {\n        var _entry$cities2;\n        var cityName = 'Ciudad Desconocida';\n        if ((_entry$cities2 = entry.cities) != null && _entry$cities2.name) {\n          cityName = entry.cities.name;\n        } else if (entry.cityName) {\n          cityName = entry.cityName;\n        } else if (entry.city_name) {\n          cityName = entry.city_name;\n        } else if (entry.tags && Array.isArray(entry.tags)) {\n          var cityTag = entry.tags.find(function (tag) {\n            return tag !== 'misión' && tag !== 'mission' && tag !== 'viaje' && tag !== 'travel';\n          });\n          if (cityTag) {\n            cityName = cityTag.charAt(0).toUpperCase() + cityTag.slice(1);\n          }\n        }\n        return {\n          id: entry.id || `generated-${Date.now()}-${Math.random().toString(36).substring(2, 9)}`,\n          userId: entry.userId || '',\n          cityId: entry.cityId || '',\n          missionId: entry.missionId || missionId,\n          title: entry.title || 'Entrada sin título',\n          content: entry.content || '',\n          photos: Array.isArray(entry.photos) ? entry.photos : entry.photos ? [entry.photos] : [],\n          location: entry.location || null,\n          created_at: entry.created_at || new Date().toISOString(),\n          tags: Array.isArray(entry.tags) ? entry.tags : [],\n          city_name: cityName\n        };\n      });\n    } catch (error) {\n      console.error('Error obteniendo entradas de la misión:', error);\n      throw error;\n    }\n  });\n  return function getMissionJournalEntries(_x2, _x3) {\n    return _ref3.apply(this, arguments);\n  };\n}();\nexport var createJournalEntry = function () {\n  var _ref4 = _asyncToGenerator(function* (data) {\n    try {\n      try {\n        var _error$message;\n        var _yield$supabase$from$9 = yield supabase.from('journal_entries').insert(data),\n          _error = _yield$supabase$from$9.error;\n        if (!_error) return true;\n        if (_error.code === '404' || (_error$message = _error.message) != null && _error$message.includes('not found')) {\n          console.log('Tabla journal_entries no encontrada, intentando con journey_diary');\n        } else {\n          throw _error;\n        }\n      } catch (e) {\n        console.warn('Error con journal_entries, intentando con journey_diary');\n      }\n      var _yield$supabase$from$10 = yield supabase.from('journey_diary').insert(data),\n        error = _yield$supabase$from$10.error;\n      if (error) throw error;\n      return true;\n    } catch (error) {\n      console.error('Error creando entrada en el diario:', error);\n      return false;\n    }\n  });\n  return function createJournalEntry(_x4) {\n    return _ref4.apply(this, arguments);\n  };\n}();","map":{"version":3,"names":["supabase","checkJournalTables","_ref","_asyncToGenerator","_yield$Promise$allSet","Promise","allSettled","from","select","limit","_yield$Promise$allSet2","_slicedToArray","journalEntriesResult","journeyDiaryResult","journalEntriesExists","status","value","error","journeyDiaryExists","console","apply","arguments","getUserJournalEntries","_ref2","userId","_yield$checkJournalTa","warn","entriesData","_yield$supabase$from$","eq","order","ascending","data","entriesError","message","includes","code","_yield$supabase$from$2","basicData","basicError","e","_yield$supabase$from$3","diaryError","_yield$supabase$from$4","organizeCityEntries","_x","missingCityRelation","length","undefined","entriesByCity","forEach","entry","_entry$cities","cityName","cities","name","city_name","tags","Array","isArray","cityTag","find","tag","charAt","toUpperCase","slice","processedEntry","id","Date","now","Math","random","toString","substring","cityId","missionId","title","content","photos","location","created_at","toISOString","push","getMissionJournalEntries","_ref3","_yield$checkJournalTa2","_yield$supabase$from$5","_yield$supabase$from$6","_yield$supabase$from$7","_yield$supabase$from$8","map","_entry$cities2","_x2","_x3","createJournalEntry","_ref4","_error$message","_yield$supabase$from$9","insert","log","_yield$supabase$from$10","_x4"],"sources":["C:/Users/migue/TravelQuest/src/services/journalService.ts"],"sourcesContent":["import { supabase } from './supabase';\r\n\r\nexport interface JournalEntryDB {\r\n  id: string;\r\n  userId: string;\r\n  cityId: string;\r\n  missionId?: string;\r\n  title: string;\r\n  content: string;\r\n  photos: string[];\r\n  location: {\r\n    latitude: number;\r\n    longitude: number;\r\n  } | null;\r\n  created_at: string;\r\n  tags: string[];\r\n}\r\n\r\nexport interface CityJournalEntry extends JournalEntryDB {\r\n  city_name: string;\r\n}\r\n\r\n/**\r\n * Verifica si existe la tabla journal_entries o journey_diary en la base de datos\r\n * @returns objeto con la información de qué tablas existen\r\n */\r\nexport const checkJournalTables = async (): Promise<{journalEntriesExists: boolean, journeyDiaryExists: boolean}> => {\r\n  try {\r\n    // Probamos si las tablas existen obteniendo solo una fila de cada una\r\n    const [journalEntriesResult, journeyDiaryResult] = await Promise.allSettled([\r\n      supabase.from('journal_entries').select('id').limit(1),\r\n      supabase.from('journey_diary').select('id').limit(1)\r\n    ]);\r\n    \r\n    return {\r\n      journalEntriesExists: journalEntriesResult.status === 'fulfilled' && !journalEntriesResult.value.error,\r\n      journeyDiaryExists: journeyDiaryResult.status === 'fulfilled' && !journeyDiaryResult.value.error\r\n    };\r\n  } catch (error) {\r\n    console.error('Error verificando tablas del diario:', error);\r\n    return {\r\n      journalEntriesExists: false,\r\n      journeyDiaryExists: false\r\n    };\r\n  }\r\n};\r\n\r\n/**\r\n * Obtiene todas las entradas del diario del usuario agrupadas por ciudad\r\n * @param userId ID del usuario \r\n * @returns Entradas del diario agrupadas por ciudad\r\n */\r\nexport const getUserJournalEntries = async (userId: string): Promise<{ [cityName: string]: CityJournalEntry[] }> => {\r\n  try {\r\n    // Verificar qué tablas existen\r\n    const { journalEntriesExists, journeyDiaryExists } = await checkJournalTables();\r\n    \r\n    if (!journalEntriesExists && !journeyDiaryExists) {\r\n      console.warn('No se encontraron tablas para el diario (journal_entries o journey_diary)');\r\n      return {}; // Devolvemos un objeto vacío\r\n    }\r\n\r\n    let entriesData = null;\r\n    let error = null;\r\n\r\n    // Primero intentamos con journal_entries si existe\r\n    if (journalEntriesExists) {\r\n      try {\r\n        // Intentamos con la relación a cities\r\n        const { data, error: entriesError } = await supabase\r\n          .from('journal_entries')\r\n          .select(`\r\n            *,\r\n            cities:cityId (\r\n              name\r\n            )\r\n          `)\r\n          .eq('userId', userId)\r\n          .order('created_at', { ascending: false });\r\n\r\n        if (!entriesError) {\r\n          entriesData = data;\r\n        } else if (entriesError.message && (\r\n          entriesError.message.includes('cityId') || \r\n          entriesError.message.includes('relationship') ||\r\n          entriesError.code === 'PGRST200')) {\r\n          \r\n          // Si hay error de relación, intentamos sin la relación\r\n          const { data: basicData, error: basicError } = await supabase\r\n            .from('journal_entries')\r\n            .select('*')\r\n            .eq('userId', userId)\r\n            .order('created_at', { ascending: false });\r\n          \r\n          if (!basicError) {\r\n            entriesData = basicData;\r\n          } else {\r\n            error = basicError;\r\n          }\r\n        } else {\r\n          error = entriesError;\r\n        }\r\n      } catch (e) {\r\n        console.warn('Error al obtener datos de journal_entries:', e);\r\n      }\r\n    }\r\n\r\n    // Si no obtuvimos datos de journal_entries o hubo un error, intentamos con journey_diary\r\n    if (!entriesData && journeyDiaryExists) {\r\n      try {\r\n        // Intentamos con la relación a cities\r\n        const { data, error: diaryError } = await supabase\r\n          .from('journey_diary')\r\n          .select(`\r\n            *,\r\n            cities:cityId (\r\n              name\r\n            )\r\n          `)\r\n          .eq('userId', userId)\r\n          .order('created_at', { ascending: false });\r\n\r\n        if (!diaryError) {\r\n          entriesData = data;\r\n        } else if (diaryError.message && (\r\n          diaryError.message.includes('cityId') || \r\n          diaryError.message.includes('relationship') ||\r\n          diaryError.code === 'PGRST200')) {\r\n          \r\n          // Si hay error de relación, intentamos sin la relación\r\n          const { data: basicData, error: basicError } = await supabase\r\n            .from('journey_diary')\r\n            .select('*')\r\n            .eq('userId', userId)\r\n            .order('created_at', { ascending: false });\r\n          \r\n          if (!basicError) {\r\n            entriesData = basicData;\r\n          } else if (!error) { // Solo guardamos este error si no teníamos uno previo\r\n            error = basicError;\r\n          }\r\n        } else if (!error) { // Solo guardamos este error si no teníamos uno previo\r\n          error = diaryError;\r\n        }\r\n      } catch (e) {\r\n        console.warn('Error al obtener datos de journey_diary:', e);\r\n      }\r\n    }\r\n\r\n    // Si después de intentar con ambas tablas seguimos sin datos y tenemos un error, lo lanzamos\r\n    if (!entriesData && error) {\r\n      throw error;\r\n    }\r\n\r\n    // Si no hay datos (pero no hubo error), devolvemos un objeto vacío\r\n    if (!entriesData) {\r\n      return {};\r\n    }\r\n    \r\n    // Organizar las entradas por ciudad\r\n    return organizeCityEntries(entriesData, true);\r\n  } catch (error) {\r\n    console.error('Error obteniendo entradas del diario:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * Organiza las entradas del diario por ciudad\r\n * @param data Datos de las entradas\r\n * @param missingCityRelation Indica si falta la relación con la ciudad\r\n * @returns Entradas organizadas por ciudad\r\n */\r\nconst organizeCityEntries = (\r\n  data: any[] | null, \r\n  missingCityRelation: boolean = false\r\n): { [cityName: string]: CityJournalEntry[] } => {\r\n  const entriesByCity: { [cityName: string]: CityJournalEntry[] } = {};\r\n  \r\n  if (!data || data.length === 0) {\r\n    return entriesByCity;\r\n  }\r\n  \r\n  data.forEach((entry: any) => {\r\n    let cityName = 'Ciudad Desconocida';\r\n    \r\n    // Intentamos obtener el nombre de la ciudad de varias formas posibles\r\n    if (!missingCityRelation && entry.cities?.name) {\r\n      cityName = entry.cities.name;\r\n    } else if (entry.cityName) {\r\n      cityName = entry.cityName;\r\n    } else if (entry.city_name) {\r\n      cityName = entry.city_name;\r\n    } else {\r\n      // Buscar el cityId en las etiquetas y usar la primera que parece ser un nombre de ciudad\r\n      if (entry.tags && Array.isArray(entry.tags)) {\r\n        const cityTag = entry.tags.find((tag: string) => \r\n          tag !== 'misión' && tag !== 'mission' && tag !== 'viaje' && tag !== 'travel'\r\n        );\r\n        if (cityTag) {\r\n          cityName = cityTag.charAt(0).toUpperCase() + cityTag.slice(1); // Capitalizar\r\n        }\r\n      }\r\n    }\r\n    \r\n    if (!entriesByCity[cityName]) {\r\n      entriesByCity[cityName] = [];\r\n    }\r\n    \r\n    // Nos aseguramos de que todos los campos necesarios existan\r\n    const processedEntry: CityJournalEntry = {\r\n      id: entry.id || `generated-${Date.now()}-${Math.random().toString(36).substring(2, 9)}`,\r\n      userId: entry.userId || '',\r\n      cityId: entry.cityId || '',\r\n      missionId: entry.missionId || undefined,\r\n      title: entry.title || 'Entrada sin título',\r\n      content: entry.content || '',\r\n      photos: Array.isArray(entry.photos) ? entry.photos : \r\n              (entry.photos ? [entry.photos] : []),\r\n      location: entry.location || null,\r\n      created_at: entry.created_at || new Date().toISOString(),\r\n      tags: Array.isArray(entry.tags) ? entry.tags : [],\r\n      city_name: cityName\r\n    };\r\n    \r\n    entriesByCity[cityName].push(processedEntry);\r\n  });\r\n\r\n  return entriesByCity;\r\n};\r\n\r\n/**\r\n * Obtiene las entradas del diario relacionadas con una misión específica\r\n * @param userId ID del usuario\r\n * @param missionId ID de la misión\r\n * @returns Entradas del diario relacionadas con la misión\r\n */\r\nexport const getMissionJournalEntries = async (userId: string, missionId: string): Promise<CityJournalEntry[]> => {\r\n  try {\r\n    // Verificar qué tablas existen\r\n    const { journalEntriesExists, journeyDiaryExists } = await checkJournalTables();\r\n    \r\n    if (!journalEntriesExists && !journeyDiaryExists) {\r\n      console.warn('No se encontraron tablas para el diario (journal_entries o journey_diary)');\r\n      return []; // Devolvemos un array vacío\r\n    }\r\n\r\n    let entriesData = null;\r\n    let error = null;\r\n\r\n    // Primero intentamos con journal_entries si existe\r\n    if (journalEntriesExists) {\r\n      try {\r\n        // Intentamos con la relación a cities\r\n        const { data, error: entriesError } = await supabase\r\n          .from('journal_entries')\r\n          .select(`\r\n            *,\r\n            cities:cityId (\r\n              name\r\n            )\r\n          `)\r\n          .eq('userId', userId)\r\n          .eq('missionId', missionId)\r\n          .order('created_at', { ascending: false });\r\n\r\n        if (!entriesError) {\r\n          entriesData = data;\r\n        } else if (entriesError.message && (\r\n          entriesError.message.includes('cityId') || \r\n          entriesError.message.includes('relationship') ||\r\n          entriesError.code === 'PGRST200')) {\r\n          \r\n          // Si hay error de relación, intentamos sin la relación\r\n          const { data: basicData, error: basicError } = await supabase\r\n            .from('journal_entries')\r\n            .select('*')\r\n            .eq('userId', userId)\r\n            .eq('missionId', missionId)\r\n            .order('created_at', { ascending: false });\r\n          \r\n          if (!basicError) {\r\n            entriesData = basicData;\r\n          } else {\r\n            error = basicError;\r\n          }\r\n        } else {\r\n          error = entriesError;\r\n        }\r\n      } catch (e) {\r\n        console.warn('Error al obtener datos de journal_entries para misión:', e);\r\n      }\r\n    }\r\n\r\n    // Si no obtuvimos datos de journal_entries o hubo error, intentamos con journey_diary\r\n    if (!entriesData && journeyDiaryExists) {\r\n      try {\r\n        // Intentamos con la relación a cities\r\n        const { data, error: diaryError } = await supabase\r\n          .from('journey_diary')\r\n          .select(`\r\n            *,\r\n            cities:cityId (\r\n              name\r\n            )\r\n          `)\r\n          .eq('userId', userId)\r\n          .eq('missionId', missionId)\r\n          .order('created_at', { ascending: false });\r\n\r\n        if (!diaryError) {\r\n          entriesData = data;\r\n        } else if (diaryError.message && (\r\n          diaryError.message.includes('cityId') || \r\n          diaryError.message.includes('relationship') ||\r\n          diaryError.code === 'PGRST200')) {\r\n          \r\n          // Si hay error de relación, intentamos sin la relación\r\n          const { data: basicData, error: basicError } = await supabase\r\n            .from('journey_diary')\r\n            .select('*')\r\n            .eq('userId', userId)\r\n            .eq('missionId', missionId)\r\n            .order('created_at', { ascending: false });\r\n          \r\n          if (!basicError) {\r\n            entriesData = basicData;\r\n          } else if (!error) { // Solo guardamos este error si no teníamos uno previo\r\n            error = basicError;\r\n          }\r\n        } else if (!error) { // Solo guardamos este error si no teníamos uno previo\r\n          error = diaryError;\r\n        }\r\n      } catch (e) {\r\n        console.warn('Error al obtener datos de journey_diary para misión:', e);\r\n      }\r\n    }\r\n\r\n    // Si después de intentar con ambas tablas seguimos sin datos y tenemos un error, lo lanzamos\r\n    if (!entriesData && error) {\r\n      throw error;\r\n    }\r\n\r\n    // Si no hay datos (pero no hubo error), devolvemos un array vacío\r\n    if (!entriesData || entriesData.length === 0) {\r\n      return [];\r\n    }\r\n    \r\n    // Procesamos las entradas para asegurar el formato correcto\r\n    return entriesData.map((entry: any) => {\r\n      let cityName = 'Ciudad Desconocida';\r\n      \r\n      if (entry.cities?.name) {\r\n        cityName = entry.cities.name;\r\n      } else if (entry.cityName) {\r\n        cityName = entry.cityName;\r\n      } else if (entry.city_name) {\r\n        cityName = entry.city_name;\r\n      } else if (entry.tags && Array.isArray(entry.tags)) {\r\n        const cityTag = entry.tags.find((tag: string) => \r\n          tag !== 'misión' && tag !== 'mission' && tag !== 'viaje' && tag !== 'travel'\r\n        );\r\n        if (cityTag) {\r\n          cityName = cityTag.charAt(0).toUpperCase() + cityTag.slice(1); // Capitalizar\r\n        }\r\n      }\r\n      \r\n      return {\r\n        id: entry.id || `generated-${Date.now()}-${Math.random().toString(36).substring(2, 9)}`,\r\n        userId: entry.userId || '',\r\n        cityId: entry.cityId || '',\r\n        missionId: entry.missionId || missionId,\r\n        title: entry.title || 'Entrada sin título',\r\n        content: entry.content || '',\r\n        photos: Array.isArray(entry.photos) ? entry.photos : \r\n                (entry.photos ? [entry.photos] : []),\r\n        location: entry.location || null,\r\n        created_at: entry.created_at || new Date().toISOString(),\r\n        tags: Array.isArray(entry.tags) ? entry.tags : [],\r\n        city_name: cityName\r\n      };\r\n    });\r\n  } catch (error) {\r\n    console.error('Error obteniendo entradas de la misión:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport const createJournalEntry = async (data: {\r\n  userId: string;\r\n  cityId: string;\r\n  missionId: string;\r\n  title: string;\r\n  content: string;\r\n  photos: string[];\r\n  tags?: string[];\r\n}) => {\r\n  try {\r\n    // Intentar primero con journal_entries\r\n    try {\r\n      const { error } = await supabase\r\n        .from('journal_entries')\r\n        .insert(data);\r\n      \r\n      if (!error) return true;\r\n      \r\n      // Si hay error 404, la tabla no existe\r\n      if (error.code === '404' || error.message?.includes('not found')) {\r\n        console.log('Tabla journal_entries no encontrada, intentando con journey_diary');\r\n      } else {\r\n        throw error;\r\n      }\r\n    } catch (e) {\r\n      console.warn('Error con journal_entries, intentando con journey_diary');\r\n    }\r\n    \r\n    // Intentar con journey_diary como alternativa\r\n    const { error } = await supabase\r\n      .from('journey_diary')\r\n      .insert(data);\r\n    \r\n    if (error) throw error;\r\n    \r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error creando entrada en el diario:', error);\r\n    return false;\r\n  }\r\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}