{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport Platform from \"react-native-web/dist/exports/Platform\";\nimport { CLOUDINARY_CONFIG } from \"../config/cloudinary\";\nvar CLOUDINARY_CLOUD_NAME = CLOUDINARY_CONFIG.CLOUD_NAME;\nvar CLOUDINARY_UPLOAD_PRESET = CLOUDINARY_CONFIG.UPLOAD_PRESET;\nvar CLOUDINARY_URL = `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`;\nexport var isCloudinaryConfigured = function isCloudinaryConfigured() {\n  return Boolean(CLOUDINARY_CLOUD_NAME && CLOUDINARY_UPLOAD_PRESET && CLOUDINARY_CLOUD_NAME !== 'tu_cloud_name' && CLOUDINARY_UPLOAD_PRESET !== 'tu_upload_preset');\n};\nexport var getCloudinaryConfigInfo = function getCloudinaryConfigInfo() {\n  var isConfigured = isCloudinaryConfigured();\n  return {\n    isConfigured: isConfigured,\n    cloudName: CLOUDINARY_CLOUD_NAME,\n    uploadPreset: CLOUDINARY_UPLOAD_PRESET,\n    cloudNameValid: CLOUDINARY_CLOUD_NAME && CLOUDINARY_CLOUD_NAME !== 'tu_cloud_name',\n    uploadPresetValid: CLOUDINARY_UPLOAD_PRESET && CLOUDINARY_UPLOAD_PRESET !== 'tu_upload_preset',\n    usingFallback: __DEV__ && !isConfigured,\n    uploadUrl: CLOUDINARY_URL\n  };\n};\nexport var uploadImageToCloudinary = function () {\n  var _ref = _asyncToGenerator(function* (uri, missionId) {\n    try {\n      console.log('Subiendo imagen a Cloudinary...', {\n        uri: uri,\n        missionId: missionId\n      });\n      var configInfo = getCloudinaryConfigInfo();\n      console.log('Estado configuración Cloudinary:', configInfo);\n      if (__DEV__ && !configInfo.isConfigured) {\n        console.warn('ATENCIÓN: Usando URI local como fallback por falta de configuración de Cloudinary');\n        console.warn('Para habilitar Cloudinary, actualiza tus credenciales en src/config/cloudinary.ts');\n        yield new Promise(function (resolve) {\n          return setTimeout(resolve, 1500);\n        });\n        return uri;\n      }\n      if (!configInfo.isConfigured) {\n        throw new Error('La configuración de Cloudinary no es válida. Verifica tu CLOUD_NAME y UPLOAD_PRESET.');\n      }\n      var formData = new FormData();\n      var filename = uri.split('/').pop() || 'photo.jpg';\n      var localUri = uri;\n      if (Platform.OS === 'web') {\n        var _response = yield fetch(uri);\n        var blob = yield _response.blob();\n        formData.append('file', blob, filename);\n      } else {\n        var match = /\\.(\\w+)$/.exec(filename);\n        var type = match ? `image/${match[1]}` : 'image/jpeg';\n        formData.append('file', {\n          uri: localUri,\n          type: type,\n          name: filename\n        });\n      }\n      formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);\n      formData.append('folder', CLOUDINARY_CONFIG.FOLDER || 'missions');\n      formData.append('public_id', `mission_${missionId}_${Date.now()}`);\n      if (CLOUDINARY_CONFIG.TRANSFORMATION) {\n        var _CLOUDINARY_CONFIG$TR = CLOUDINARY_CONFIG.TRANSFORMATION,\n          WIDTH = _CLOUDINARY_CONFIG$TR.WIDTH,\n          HEIGHT = _CLOUDINARY_CONFIG$TR.HEIGHT,\n          QUALITY = _CLOUDINARY_CONFIG$TR.QUALITY;\n        if (WIDTH) formData.append('width', WIDTH.toString());\n        if (HEIGHT) formData.append('height', HEIGHT.toString());\n        if (QUALITY) formData.append('quality', QUALITY.toString());\n      }\n      console.log('Enviando solicitud a Cloudinary:', CLOUDINARY_URL);\n      var response = yield fetch(CLOUDINARY_URL, {\n        method: 'POST',\n        body: formData\n      });\n      if (!response.ok) {\n        var errorText = yield response.text();\n        console.error('Error respuesta Cloudinary:', {\n          status: response.status,\n          statusText: response.statusText,\n          responseText: errorText\n        });\n        throw new Error(`Error al subir imagen (${response.status}): ${response.statusText} - ${errorText}`);\n      }\n      var data = yield response.json();\n      console.log('Imagen subida exitosamente:', data.secure_url);\n      return data.secure_url;\n    } catch (error) {\n      var _error$message, _error$message2, _error$message3;\n      console.error('Error subiendo imagen a Cloudinary:', error);\n      if (__DEV__ && ((_error$message = error.message) != null && _error$message.includes('configuración') || (_error$message2 = error.message) != null && _error$message2.includes('CLOUD_NAME') || (_error$message3 = error.message) != null && _error$message3.includes('400'))) {\n        console.warn('MODO DESARROLLO: Devolviendo URI local como fallback tras error de configuración');\n        return uri;\n      }\n      throw error;\n    }\n  });\n  return function uploadImageToCloudinary(_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();","map":{"version":3,"names":["CLOUDINARY_CONFIG","CLOUDINARY_CLOUD_NAME","CLOUD_NAME","CLOUDINARY_UPLOAD_PRESET","UPLOAD_PRESET","CLOUDINARY_URL","isCloudinaryConfigured","Boolean","getCloudinaryConfigInfo","isConfigured","cloudName","uploadPreset","cloudNameValid","uploadPresetValid","usingFallback","__DEV__","uploadUrl","uploadImageToCloudinary","_ref","_asyncToGenerator","uri","missionId","console","log","configInfo","warn","Promise","resolve","setTimeout","Error","formData","FormData","filename","split","pop","localUri","Platform","OS","response","fetch","blob","append","match","exec","type","name","FOLDER","Date","now","TRANSFORMATION","_CLOUDINARY_CONFIG$TR","WIDTH","HEIGHT","QUALITY","toString","method","body","ok","errorText","text","error","status","statusText","responseText","data","json","secure_url","_error$message","_error$message2","_error$message3","message","includes","_x","_x2","apply","arguments"],"sources":["C:/Users/migue/TravelQuest/src/services/cloudinaryService.ts"],"sourcesContent":["import { Platform } from 'react-native';\r\nimport { CLOUDINARY_CONFIG } from '../config/cloudinary';\r\n\r\n// Configuración de Cloudinary\r\nconst CLOUDINARY_CLOUD_NAME = CLOUDINARY_CONFIG.CLOUD_NAME;\r\nconst CLOUDINARY_UPLOAD_PRESET = CLOUDINARY_CONFIG.UPLOAD_PRESET;\r\nconst CLOUDINARY_URL = `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`;\r\n\r\n/**\r\n * Verifica si la configuración de Cloudinary es válida\r\n * @returns {boolean} true si la configuración es válida\r\n */\r\nexport const isCloudinaryConfigured = (): boolean => {\r\n  return Boolean(\r\n    CLOUDINARY_CLOUD_NAME && \r\n    CLOUDINARY_UPLOAD_PRESET && \r\n    CLOUDINARY_CLOUD_NAME !== 'tu_cloud_name' && \r\n    CLOUDINARY_UPLOAD_PRESET !== 'tu_upload_preset'\r\n  );\r\n};\r\n\r\n/**\r\n * Obtiene detalles sobre la configuración actual de Cloudinary\r\n * @returns Objeto con información sobre el estado de la configuración\r\n */\r\nexport const getCloudinaryConfigInfo = () => {\r\n  const isConfigured = isCloudinaryConfigured();\r\n  \r\n  return {\r\n    isConfigured,\r\n    cloudName: CLOUDINARY_CLOUD_NAME,\r\n    uploadPreset: CLOUDINARY_UPLOAD_PRESET,\r\n    cloudNameValid: CLOUDINARY_CLOUD_NAME && CLOUDINARY_CLOUD_NAME !== 'tu_cloud_name',\r\n    uploadPresetValid: CLOUDINARY_UPLOAD_PRESET && CLOUDINARY_UPLOAD_PRESET !== 'tu_upload_preset',\r\n    usingFallback: __DEV__ && !isConfigured,\r\n    uploadUrl: CLOUDINARY_URL,\r\n  };\r\n};\r\n\r\n/**\r\n * Sube una imagen a Cloudinary\r\n * @param uri URI de la imagen local\r\n * @param missionId ID de la misión asociada a la imagen\r\n * @returns URL de la imagen subida a Cloudinary\r\n */\r\nexport const uploadImageToCloudinary = async (uri: string, missionId: string): Promise<string> => {\r\n  try {\r\n    console.log('Subiendo imagen a Cloudinary...', { uri, missionId });\r\n    \r\n    const configInfo = getCloudinaryConfigInfo();\r\n    console.log('Estado configuración Cloudinary:', configInfo);\r\n    \r\n    // Para pruebas, si estamos en desarrollo y no está configurado Cloudinary\r\n    // retornamos la URI local para simular el proceso\r\n    if (__DEV__ && !configInfo.isConfigured) {\r\n      console.warn('ATENCIÓN: Usando URI local como fallback por falta de configuración de Cloudinary');\r\n      console.warn('Para habilitar Cloudinary, actualiza tus credenciales en src/config/cloudinary.ts');\r\n      // Simulamos un retardo para que parezca que se está subiendo\r\n      await new Promise(resolve => setTimeout(resolve, 1500));\r\n      return uri; // Devolvemos la URI local como fallback\r\n    }\r\n    \r\n    // Verificar configuración antes de intentar subir\r\n    if (!configInfo.isConfigured) {\r\n      throw new Error('La configuración de Cloudinary no es válida. Verifica tu CLOUD_NAME y UPLOAD_PRESET.');\r\n    }\r\n    \r\n    // Preparar el formulario para la subida\r\n    const formData = new FormData();\r\n    \r\n    // Adaptamos la URI para web vs nativo\r\n    const filename = uri.split('/').pop() || 'photo.jpg';\r\n    let localUri = uri;\r\n    \r\n    if (Platform.OS === 'web') {\r\n      // Para web, podemos usar la URI directamente como Blob\r\n      const response = await fetch(uri);\r\n      const blob = await response.blob();\r\n      formData.append('file', blob, filename);\r\n    } else {\r\n      // Para nativo, necesitamos formatear la URI y tipo MIME\r\n      const match = /\\.(\\w+)$/.exec(filename);\r\n      const type = match ? `image/${match[1]}` : 'image/jpeg';\r\n      \r\n      formData.append('file', {\r\n        // @ts-ignore - Esto es necesario porque React Native y TypeScript manejan FormData de manera diferente\r\n        uri: localUri,\r\n        type,\r\n        name: filename,\r\n      } as any);\r\n    }\r\n    \r\n    // Añadir preset y metadatos\r\n    formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);\r\n    formData.append('folder', CLOUDINARY_CONFIG.FOLDER || 'missions');\r\n    formData.append('public_id', `mission_${missionId}_${Date.now()}`);\r\n    \r\n    // Añadir parámetros de transformación si están configurados\r\n    if (CLOUDINARY_CONFIG.TRANSFORMATION) {\r\n      const { WIDTH, HEIGHT, QUALITY } = CLOUDINARY_CONFIG.TRANSFORMATION;\r\n      if (WIDTH) formData.append('width', WIDTH.toString());\r\n      if (HEIGHT) formData.append('height', HEIGHT.toString());\r\n      if (QUALITY) formData.append('quality', QUALITY.toString());\r\n    }\r\n    \r\n    console.log('Enviando solicitud a Cloudinary:', CLOUDINARY_URL);\r\n    \r\n    // Realizar la solicitud\r\n    const response = await fetch(CLOUDINARY_URL, {\r\n      method: 'POST',\r\n      body: formData,\r\n    });\r\n    \r\n    if (!response.ok) {\r\n      const errorText = await response.text();\r\n      console.error('Error respuesta Cloudinary:', {\r\n        status: response.status,\r\n        statusText: response.statusText,\r\n        responseText: errorText\r\n      });\r\n      throw new Error(`Error al subir imagen (${response.status}): ${response.statusText} - ${errorText}`);\r\n    }\r\n    \r\n    const data = await response.json();\r\n    console.log('Imagen subida exitosamente:', data.secure_url);\r\n    return data.secure_url;\r\n  } catch (error: any) {\r\n    console.error('Error subiendo imagen a Cloudinary:', error);\r\n    \r\n    // Si es un error de configuración en desarrollo, devolvemos la URI local\r\n    if (__DEV__ && (\r\n      error.message?.includes('configuración') || \r\n      error.message?.includes('CLOUD_NAME') || \r\n      error.message?.includes('400')\r\n    )) {\r\n      console.warn('MODO DESARROLLO: Devolviendo URI local como fallback tras error de configuración');\r\n      return uri;\r\n    }\r\n    \r\n    // Re-lanzar el error para manejarlo en el componente\r\n    throw error;\r\n  }\r\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}