{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport { supabase } from \"./supabase\";\nvar _require = require(\"@google/generative-ai\"),\n  GoogleGenerativeAI = _require.GoogleGenerativeAI;\nvar genAI = new GoogleGenerativeAI(\"AIzaSyB4PuDOYXgbH9egme1UCO0CiRcOV4kVfMM\");\nvar getOrCreateUser = function () {\n  var _ref = _asyncToGenerator(function* (userId) {\n    try {\n      var _yield$supabase$from$ = yield supabase.from('users').select('id').eq('id', userId).single(),\n        existingUser = _yield$supabase$from$.data,\n        searchError = _yield$supabase$from$.error;\n      if (searchError && searchError.code !== 'PGRST116') {\n        throw searchError;\n      }\n      if (existingUser) {\n        return existingUser.id;\n      }\n      var _yield$supabase$from$2 = yield supabase.from('users').insert([{\n          id: userId,\n          email: `${userId}@temp.com`,\n          username: `user_${userId.slice(0, 8)}`,\n          password: 'temp_password'\n        }]).select('id').single(),\n        newUser = _yield$supabase$from$2.data,\n        insertError = _yield$supabase$from$2.error;\n      if (insertError) throw insertError;\n      return newUser.id;\n    } catch (error) {\n      console.error('Error al obtener/crear el usuario:', error);\n      throw error;\n    }\n  });\n  return function getOrCreateUser(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\nvar getOrCreateCity = function () {\n  var _ref2 = _asyncToGenerator(function* (cityName) {\n    try {\n      var _yield$supabase$from$3 = yield supabase.from('cities').select('id').eq('name', cityName).single(),\n        existingCity = _yield$supabase$from$3.data,\n        searchError = _yield$supabase$from$3.error;\n      if (searchError && searchError.code !== 'PGRST116') {\n        throw searchError;\n      }\n      if (existingCity) {\n        return existingCity.id;\n      }\n      var _yield$supabase$from$4 = yield supabase.from('cities').insert([{\n          name: cityName\n        }]).select('id').single(),\n        newCity = _yield$supabase$from$4.data,\n        insertError = _yield$supabase$from$4.error;\n      if (insertError) throw insertError;\n      return newCity.id;\n    } catch (error) {\n      console.error('Error al obtener/crear la ciudad:', error);\n      throw error;\n    }\n  });\n  return function getOrCreateCity(_x2) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nvar getExistingChallenges = function () {\n  var _ref3 = _asyncToGenerator(function* (cityId, count, userId) {\n    try {\n      var _yield$supabase$from$5 = yield supabase.from('challenges').select('*').eq('cityId', cityId),\n        challenges = _yield$supabase$from$5.data,\n        error = _yield$supabase$from$5.error;\n      if (error) throw error;\n      if (!challenges || challenges.length === 0) {\n        return null;\n      }\n      var _yield$supabase$from$6 = yield supabase.from('journeys').select('id').eq('userId', userId),\n        userJourneys = _yield$supabase$from$6.data,\n        journeysError = _yield$supabase$from$6.error;\n      if (journeysError) throw journeysError;\n      if (!userJourneys || userJourneys.length === 0) {\n        if (challenges.length >= 10) {\n          var shuffled = challenges.sort(function () {\n            return 0.5 - Math.random();\n          });\n          return shuffled.slice(0, count);\n        }\n        return null;\n      }\n      var _yield$supabase$from$7 = yield supabase.from('journeys_missions').select('challengeId').in('journeyId', userJourneys.map(function (j) {\n          return j.id;\n        })).in('challengeId', challenges.map(function (c) {\n          return c.id;\n        })),\n        userChallenges = _yield$supabase$from$7.data,\n        userError = _yield$supabase$from$7.error;\n      if (userError) throw userError;\n      var userChallengeIds = new Set((userChallenges == null ? void 0 : userChallenges.map(function (uc) {\n        return uc.challengeId;\n      })) || []);\n      var availableChallenges = challenges.filter(function (c) {\n        return !userChallengeIds.has(c.id);\n      });\n      if (availableChallenges.length >= 10) {\n        var _shuffled = availableChallenges.sort(function () {\n          return 0.5 - Math.random();\n        });\n        return _shuffled.slice(0, count);\n      }\n      return null;\n    } catch (error) {\n      console.error('Error obteniendo desafíos existentes:', error);\n      throw error;\n    }\n  });\n  return function getExistingChallenges(_x3, _x4, _x5) {\n    return _ref3.apply(this, arguments);\n  };\n}();\nexport var generateMission = function () {\n  var _ref4 = _asyncToGenerator(function* (cityName, duration, missionCount, userId, startDate, endDate) {\n    var tags = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : [];\n    try {\n      console.log('generateMission recibió fechas:', {\n        startDate: startDate,\n        endDate: endDate,\n        duration: duration\n      });\n      console.log('Tags seleccionados:', tags);\n      var validStartDate = startDate instanceof Date ? startDate : new Date();\n      var validEndDate = endDate instanceof Date ? endDate : new Date(Date.now() + duration * 24 * 60 * 60 * 1000);\n      var startIsoString = validStartDate.toISOString();\n      var endIsoString = validEndDate.toISOString();\n      console.log('Fechas validadas para misiones:', {\n        startIsoString: startIsoString,\n        endIsoString: endIsoString\n      });\n      console.log('Iniciando generación de misión:', {\n        cityName: cityName,\n        duration: duration,\n        missionCount: missionCount,\n        userId: userId,\n        startDate: startDate,\n        endDate: endDate,\n        tags: tags\n      });\n      yield getOrCreateUser(userId);\n      var model = genAI.getGenerativeModel({\n        model: \"gemini-1.5-flash\"\n      });\n      var cityCorrectionPrompt = `Corrige el nombre de la ciudad \"${cityName}\" al nombre oficial y correcto. \n    Devuelve SOLO el nombre corregido, sin explicaciones ni formato adicional. \n    Por ejemplo, si el usuario escribe \"akilante\", debes devolver \"Alicante\".`;\n      console.log('Prompt de corrección de ciudad:', cityCorrectionPrompt);\n      var cityCorrectionResult = yield model.generateContent(cityCorrectionPrompt);\n      var cityCorrectionResponse = yield cityCorrectionResult.response;\n      var correctedCityName = cityCorrectionResponse.text().trim();\n      console.log('Nombre de ciudad corregido:', correctedCityName);\n      var cityId = yield getOrCreateCity(correctedCityName);\n      console.log('CityId obtenido/creado:', cityId);\n      var _yield$supabase$from$8 = yield supabase.from('journeys').insert([{\n          userId: userId,\n          cityId: cityId,\n          description: `Viaje a ${correctedCityName} por ${duration} días`,\n          created_at: new Date().toISOString(),\n          start_date: startIsoString,\n          end_date: endIsoString\n        }]).select('id').single(),\n        journey = _yield$supabase$from$8.data,\n        journeyError = _yield$supabase$from$8.error;\n      if (journeyError) {\n        console.error('Error creando journey:', journeyError);\n        throw journeyError;\n      }\n      console.log('Journey creado:', journey);\n      var existingChallenges = yield getExistingChallenges(cityId, missionCount, userId);\n      console.log('Desafíos existentes encontrados:', existingChallenges);\n      var challenges;\n      if (existingChallenges && existingChallenges.length > 0) {\n        console.log('Usando desafíos existentes');\n        challenges = existingChallenges;\n      } else {\n        console.log('Generando nuevos desafíos');\n        var preferencesText = '';\n        if (tags && tags.length > 0) {\n          preferencesText = `Las misiones deben basarse en las siguientes preferencias del usuario: ${tags.join(', ')}.`;\n        }\n        var missionPrompt = `Genera ${missionCount} misiones en ${correctedCityName} que se puedan completar en ${duration} días. ${preferencesText}\n      \nDevuelve un objeto JSON con la siguiente estructura exacta:\n{\n  \"misiones\": [\n    {\n      \"Título\": \"Título de la misión\",\n      \"Descripción\": \"Descripción detallada de la misión incluyendo qué foto tomar\",\n      \"Dificultad\": \"Fácil|Media|Difícil\",\n      \"Puntos\": 25|50|100\n    }\n  ]\n}\nLos puntos deben ser: 25 para Fácil, 50 para Media, 100 para Difícil. No incluyas explicaciones adicionales, solo el JSON.`;\n        console.log('Prompt de misiones:', missionPrompt);\n        var result = yield model.generateContent(missionPrompt);\n        var response = yield result.response;\n        var missionsData = response.text();\n        console.log('Respuesta de la API:', missionsData);\n        var jsonMatch = missionsData.match(/\\{[\\s\\S]*\\}/);\n        if (!jsonMatch) {\n          throw new Error('No se encontró un objeto JSON válido en la respuesta');\n        }\n        var missions = JSON.parse(jsonMatch[0]);\n        if (!missions.misiones || !Array.isArray(missions.misiones)) {\n          throw new Error('La respuesta no contiene un array de misiones válido');\n        }\n        var formattedChallenges = missions.misiones.map(function (mission) {\n          return {\n            title: mission.Título,\n            description: mission.Descripción,\n            cityId: cityId,\n            duration: duration,\n            difficulty: mission.Dificultad,\n            points: mission.Puntos\n          };\n        });\n        var _yield$supabase$from$9 = yield supabase.from('challenges').insert(formattedChallenges).select('id'),\n          newChallenges = _yield$supabase$from$9.data,\n          challengesError = _yield$supabase$from$9.error;\n        if (challengesError) throw challengesError;\n        challenges = newChallenges;\n      }\n      var journeyMissions = challenges.map(function (challenge) {\n        return {\n          journeyId: journey.id,\n          challengeId: challenge.id,\n          completed: false,\n          created_at: new Date().toISOString(),\n          start_date: startIsoString,\n          end_date: endIsoString\n        };\n      });\n      console.log('Vincular misiones al journey:', journeyMissions);\n      var _yield$supabase$from$10 = yield supabase.from('journeys_missions').insert(journeyMissions),\n        linkError = _yield$supabase$from$10.error;\n      if (linkError) {\n        console.error('Error vinculando misiones:', linkError);\n        throw linkError;\n      }\n      var _yield$supabase$from$11 = yield supabase.from('journeys_missions').select(`\n        id,\n        challengeId,\n        completed,\n        challenge:challenges (\n        title,\n        description,\n        difficulty,\n          points\n        )\n      `).eq('journeyId', journey.id).order('created_at', {\n          ascending: true\n        }),\n        createdMissions = _yield$supabase$from$11.data,\n        verifyError = _yield$supabase$from$11.error;\n      if (verifyError) {\n        console.error('Error verificando misiones creadas:', verifyError);\n        throw verifyError;\n      }\n      if (!createdMissions || createdMissions.length === 0) {\n        throw new Error('No se pudieron crear las misiones');\n      }\n      console.log('Misiones creadas verificadas:', createdMissions);\n      return {\n        journeyId: journey.id,\n        challenges: createdMissions\n      };\n    } catch (error) {\n      console.error('Error generando misiones:', error);\n      throw error;\n    }\n  });\n  return function generateMission(_x6, _x7, _x8, _x9, _x10, _x11) {\n    return _ref4.apply(this, arguments);\n  };\n}();\nexport default generateMission;","map":{"version":3,"names":["supabase","_require","require","GoogleGenerativeAI","genAI","getOrCreateUser","_ref","_asyncToGenerator","userId","_yield$supabase$from$","from","select","eq","single","existingUser","data","searchError","error","code","id","_yield$supabase$from$2","insert","email","username","slice","password","newUser","insertError","console","_x","apply","arguments","getOrCreateCity","_ref2","cityName","_yield$supabase$from$3","existingCity","_yield$supabase$from$4","name","newCity","_x2","getExistingChallenges","_ref3","cityId","count","_yield$supabase$from$5","challenges","length","_yield$supabase$from$6","userJourneys","journeysError","shuffled","sort","Math","random","_yield$supabase$from$7","in","map","j","c","userChallenges","userError","userChallengeIds","Set","uc","challengeId","availableChallenges","filter","has","_x3","_x4","_x5","generateMission","_ref4","duration","missionCount","startDate","endDate","tags","undefined","log","validStartDate","Date","validEndDate","now","startIsoString","toISOString","endIsoString","model","getGenerativeModel","cityCorrectionPrompt","cityCorrectionResult","generateContent","cityCorrectionResponse","response","correctedCityName","text","trim","_yield$supabase$from$8","description","created_at","start_date","end_date","journey","journeyError","existingChallenges","preferencesText","join","missionPrompt","result","missionsData","jsonMatch","match","Error","missions","JSON","parse","misiones","Array","isArray","formattedChallenges","mission","title","Título","Descripción","difficulty","Dificultad","points","Puntos","_yield$supabase$from$9","newChallenges","challengesError","journeyMissions","challenge","journeyId","completed","_yield$supabase$from$10","linkError","_yield$supabase$from$11","order","ascending","createdMissions","verifyError","_x6","_x7","_x8","_x9","_x10","_x11"],"sources":["C:/Users/migue/TravelQuest/src/services/missionGenerator.ts"],"sourcesContent":["import { supabase } from './supabase';\nconst { GoogleGenerativeAI } = require(\"@google/generative-ai\");\n\n// Accede a tu clave de API como una variable de entorno\nconst genAI = new GoogleGenerativeAI(\"AIzaSyB4PuDOYXgbH9egme1UCO0CiRcOV4kVfMM\");\n\n// Interfaces para los tipos de datos\ninterface Challenge {\n  id: string;\n}\n\ninterface UserChallenge {\n  challengeId: string;\n}\n\ninterface Journey {\n  id: string;\n}\n\n// Función para verificar y crear usuario si no existe\nconst getOrCreateUser = async (userId: string) => {\n  try {\n    // Verificar si el usuario existe\n    const { data: existingUser, error: searchError } = await supabase\n      .from('users')\n      .select('id')\n      .eq('id', userId)\n      .single();\n\n    if (searchError && searchError.code !== 'PGRST116') {\n      throw searchError;\n    }\n\n    if (existingUser) {\n      return existingUser.id;\n    }\n\n    // Si no existe, crear el usuario\n    const { data: newUser, error: insertError } = await supabase\n      .from('users')\n      .insert([{\n        id: userId,\n        email: `${userId}@temp.com`, // Email temporal\n        username: `user_${userId.slice(0, 8)}`, // Username temporal\n        password: 'temp_password' // Contraseña temporal\n      }])\n      .select('id')\n      .single();\n\n    if (insertError) throw insertError;\n\n    return newUser.id;\n  } catch (error) {\n    console.error('Error al obtener/crear el usuario:', error);\n    throw error;\n  }\n};\n\n// Función para obtener o crear una ciudad\nconst getOrCreateCity = async (cityName: string) => {\n  try {\n    // Primero intentamos encontrar la ciudad\n    const { data: existingCity, error: searchError } = await supabase\n      .from('cities')\n      .select('id')\n      .eq('name', cityName)\n      .single();\n\n    if (searchError && searchError.code !== 'PGRST116') { // PGRST116 es el código para \"no se encontraron resultados\"\n      throw searchError;\n    }\n\n    if (existingCity) {\n      return existingCity.id;\n    }\n\n    // Si no existe la ciudad, la creamos\n    const { data: newCity, error: insertError } = await supabase\n      .from('cities')\n      .insert([{ name: cityName }])\n      .select('id')\n      .single();\n\n    if (insertError) throw insertError;\n\n    return newCity.id;\n  } catch (error) {\n    console.error('Error al obtener/crear la ciudad:', error);\n    throw error;\n  }\n};\n\n// Función para obtener desafíos existentes de una ciudad que el usuario no haya solicitado\nconst getExistingChallenges = async (cityId: string, count: number, userId: string) => {\n  try {\n    // Primero obtenemos todos los desafíos de la ciudad\n    const { data: challenges, error } = await supabase\n      .from('challenges')\n      .select('*') // Seleccionar todos los campos, no solo el id\n      .eq('cityId', cityId);\n\n    if (error) throw error;\n\n    if (!challenges || challenges.length === 0) {\n      return null;\n    }\n\n    // Obtener los desafíos que el usuario ya ha solicitado\n    // Primero obtenemos los journeys del usuario\n    const { data: userJourneys, error: journeysError } = await supabase\n      .from('journeys')\n      .select('id')\n      .eq('userId', userId);\n\n    if (journeysError) throw journeysError;\n\n    if (!userJourneys || userJourneys.length === 0) {\n      // Si el usuario no tiene journeys, seleccionar aleatoriamente la cantidad solicitada\n      if (challenges.length >= 10) {\n        const shuffled = challenges.sort(() => 0.5 - Math.random());\n        return shuffled.slice(0, count);\n      }\n      return null;\n    }\n\n    // Luego obtenemos los desafíos asociados a esos journeys\n    const { data: userChallenges, error: userError } = await supabase\n      .from('journeys_missions')\n      .select('challengeId')\n      .in('journeyId', userJourneys.map((j: Journey) => j.id))\n      .in('challengeId', challenges.map((c: Challenge) => c.id));\n\n    if (userError) throw userError;\n\n    // Filtrar los desafíos que el usuario ya ha solicitado\n    const userChallengeIds = new Set(userChallenges?.map((uc: UserChallenge) => uc.challengeId) || []);\n    const availableChallenges = challenges.filter((c: Challenge) => !userChallengeIds.has(c.id));\n\n    // Si hay suficientes desafíos disponibles (10 o más)\n    if (availableChallenges.length >= 10) {\n      // Mezclar el array de desafíos disponibles\n      const shuffled = availableChallenges.sort(() => 0.5 - Math.random());\n      // Tomar solo la cantidad solicitada\n      return shuffled.slice(0, count);\n    }\n\n    return null; // Retornar null si no hay suficientes desafíos disponibles\n  } catch (error) {\n    console.error('Error obteniendo desafíos existentes:', error);\n    throw error;\n  }\n};\n\nexport const generateMission = async (\n  cityName: string, \n  duration: number, \n  missionCount: number, \n  userId: string,\n  startDate: Date | null,\n  endDate: Date | null,\n  tags: string[] = []\n) => {\n  try {\n    console.log('generateMission recibió fechas:', {\n      startDate,\n      endDate,\n      duration\n    });\n    \n    console.log('Tags seleccionados:', tags);\n    \n    // Crear fechas por defecto si no se proporcionan\n    const validStartDate = startDate instanceof Date ? startDate : new Date();\n    const validEndDate = endDate instanceof Date ? endDate : new Date(Date.now() + duration * 24 * 60 * 60 * 1000);\n    \n    // Convertir a ISO string para la base de datos\n    const startIsoString = validStartDate.toISOString();\n    const endIsoString = validEndDate.toISOString();\n    \n    console.log('Fechas validadas para misiones:', {\n      startIsoString,\n      endIsoString\n    });\n    \n    console.log('Iniciando generación de misión:', { \n      cityName, \n      duration, \n      missionCount, \n      userId,\n      startDate,\n      endDate,\n      tags\n    });\n\n    // Verificar y crear usuario si no existe\n    await getOrCreateUser(userId);\n\n    // Primero, usar Gemini para corregir el nombre de la ciudad\n    const model = genAI.getGenerativeModel({ model: \"gemini-1.5-flash\" });\n    \n    const cityCorrectionPrompt = `Corrige el nombre de la ciudad \"${cityName}\" al nombre oficial y correcto. \n    Devuelve SOLO el nombre corregido, sin explicaciones ni formato adicional. \n    Por ejemplo, si el usuario escribe \"akilante\", debes devolver \"Alicante\".`;\n    \n    console.log('Prompt de corrección de ciudad:', cityCorrectionPrompt);\n    const cityCorrectionResult = await model.generateContent(cityCorrectionPrompt);\n    const cityCorrectionResponse = await cityCorrectionResult.response;\n    const correctedCityName = cityCorrectionResponse.text().trim();\n    \n    console.log('Nombre de ciudad corregido:', correctedCityName);\n\n    // Obtener o crear la ciudad con el nombre corregido\n    const cityId = await getOrCreateCity(correctedCityName);\n    console.log('CityId obtenido/creado:', cityId);\n\n    // Crear un nuevo journey\n    const { data: journey, error: journeyError } = await supabase\n      .from('journeys')\n      .insert([{\n        userId,\n        cityId,\n        description: `Viaje a ${correctedCityName} por ${duration} días`,\n        created_at: new Date().toISOString(),\n        start_date: startIsoString,\n        end_date: endIsoString\n      }])\n      .select('id')\n      .single();\n\n    if (journeyError) {\n      console.error('Error creando journey:', journeyError);\n      throw journeyError;\n    }\n\n    console.log('Journey creado:', journey);\n\n    // Verificar si hay suficientes desafíos existentes que el usuario no haya solicitado\n    const existingChallenges = await getExistingChallenges(cityId, missionCount, userId);\n    console.log('Desafíos existentes encontrados:', existingChallenges);\n\n    let challenges;\n    if (existingChallenges && existingChallenges.length > 0) {\n      // Usar desafíos existentes\n      console.log('Usando desafíos existentes');\n      challenges = existingChallenges;\n    } else {\n      // Solo generar nuevos desafíos si no hay suficientes existentes\n      console.log('Generando nuevos desafíos');\n      \n      // Preparar la parte de preferencias para el prompt\n      let preferencesText = '';\n      if (tags && tags.length > 0) {\n        preferencesText = `Las misiones deben basarse en las siguientes preferencias del usuario: ${tags.join(', ')}.`;\n      }\n      \n      // Generar nuevos desafíos\n      const missionPrompt = `Genera ${missionCount} misiones en ${correctedCityName} que se puedan completar en ${duration} días. ${preferencesText}\n      \nDevuelve un objeto JSON con la siguiente estructura exacta:\n{\n  \"misiones\": [\n    {\n      \"Título\": \"Título de la misión\",\n      \"Descripción\": \"Descripción detallada de la misión incluyendo qué foto tomar\",\n      \"Dificultad\": \"Fácil|Media|Difícil\",\n      \"Puntos\": 25|50|100\n    }\n  ]\n}\nLos puntos deben ser: 25 para Fácil, 50 para Media, 100 para Difícil. No incluyas explicaciones adicionales, solo el JSON.`;\n      \n      console.log('Prompt de misiones:', missionPrompt);\n      const result = await model.generateContent(missionPrompt);\n      const response = await result.response;\n      const missionsData = response.text();\n\n      console.log('Respuesta de la API:', missionsData);\n\n      const jsonMatch = missionsData.match(/\\{[\\s\\S]*\\}/);\n      if (!jsonMatch) {\n        throw new Error('No se encontró un objeto JSON válido en la respuesta');\n      }\n\n      const missions = JSON.parse(jsonMatch[0]);\n\n      if (!missions.misiones || !Array.isArray(missions.misiones)) {\n        throw new Error('La respuesta no contiene un array de misiones válido');\n      }\n\n      // Crear los desafíos\n      const formattedChallenges = missions.misiones.map((mission: any) => ({\n        title: mission.Título,\n        description: mission.Descripción,\n        cityId,\n        duration,\n        difficulty: mission.Dificultad,\n        points: mission.Puntos\n      }));\n\n      const { data: newChallenges, error: challengesError } = await supabase\n        .from('challenges')\n        .insert(formattedChallenges)\n        .select('id');\n\n      if (challengesError) throw challengesError;\n\n      challenges = newChallenges;\n    }\n\n    // Vincular los desafíos al journey\n    const journeyMissions = challenges.map((challenge: { id: string }) => ({\n      journeyId: journey.id,\n      challengeId: challenge.id,\n      completed: false,\n      created_at: new Date().toISOString(),\n      start_date: startIsoString,\n      end_date: endIsoString\n    }));\n\n    console.log('Vincular misiones al journey:', journeyMissions);\n\n    const { error: linkError } = await supabase\n      .from('journeys_missions')\n      .insert(journeyMissions);\n\n    if (linkError) {\n      console.error('Error vinculando misiones:', linkError);\n      throw linkError;\n    }\n\n    // Verificar que las misiones se hayan creado correctamente\n    const { data: createdMissions, error: verifyError } = await supabase\n      .from('journeys_missions')\n      .select(`\n        id,\n        challengeId,\n        completed,\n        challenge:challenges (\n        title,\n        description,\n        difficulty,\n          points\n        )\n      `)\n      .eq('journeyId', journey.id)\n      .order('created_at', { ascending: true });\n\n    if (verifyError) {\n      console.error('Error verificando misiones creadas:', verifyError);\n      throw verifyError;\n    }\n\n    if (!createdMissions || createdMissions.length === 0) {\n      throw new Error('No se pudieron crear las misiones');\n    }\n\n    console.log('Misiones creadas verificadas:', createdMissions);\n\n    return {\n      journeyId: journey.id,\n      challenges: createdMissions\n    };\n  } catch (error) {\n    console.error('Error generando misiones:', error);\n    throw error;\n  }\n};\n\nexport default generateMission;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}